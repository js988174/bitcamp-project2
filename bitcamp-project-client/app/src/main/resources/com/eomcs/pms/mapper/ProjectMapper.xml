<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ProjectMapper">
  
  <resultMap id="ProjectMap" type="com.eomcs.pms.domain.Project">
    <id column="no" property="no"/>
    <result column="title" property="title"/>
    <result column="name" property="name"/>
    <result column="content" property="content"/>
    <result column="sdt" property="startDate"/>
    <result column="edt" property="endDate"/>
    <result column="owner" property="owner"/>
    <result column="project_no" property="projectNo"/>
    
    <association property="owner" javaType="com.eomcs.pms.domain.Member">
      <id column="owner_no" property="no"/>
     
    </association>
    
  </resultMap>
  
  <insert id="insert" parameterType="com.eomcs.pms.domain.Project">
  insert into pms_project(title,content,sdt,edt,owner) 
  values(#{title},#{content},#{sdt},#{edt},#{owner.no})
  </insert>
  
  <insert id="insertMember" parameterType="com.eomcs.pms.domain.project">
  insert into pms_member_project(member_no,project_no) 
  values(#{memberNo},#{ProjectNo})
  </insert>
  
  <select id="findAll" resultMap="ProjectMap">
  select
           p.no,
           p.title,
           p.sdt,
           p.edt,
           m.no as owner_no,
           m.name as owner_name
           from pms_project p
           inner join pms_member m on p.owner=m.no
           order by title asc
  </select>
  

  <select id="findByNo" resultMap="projectMap" parameterType="int">
    select
           p.no,
           p.title,
           p.sdt,
           p.edt,
           m.no as owner_no,
           m.name as owner_name
           from pms_project p
           inner join pms_member m on p.owner=m.no
           where p.no = #{no}
  </select>
  
  <select id="findAllMembers" resultMap="projectMap" parameterType="int">
   select
            m.no,"
            m.name"
          from pms_member_project mp"
            inner join pms_member m on mp.member_no=m.no"
            where 
            mp.project_no= #{no}
  </select>
  
  <update id="update" parameterType="com.eomcs.pms.domain.Project">
  update pms_project set
             title=?,
             content=?,
             sdt=?,
             edt=?,
             owner=?
             where no=#{no}
  </update>
  
  <delete id="delete" parameterType="int">
 delete from pms_project 
 where no=#{no}
  </delete>

<delete id="deleteMembers" parameterType="com.eomcs.pms.domain.Project">
delete from pms_member_project 
where project_no=#{no}
</delete>
</mapper>







